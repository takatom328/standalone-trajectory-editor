# Standalone Trajectory Editor

自動車・ロボティクス分野向けの軌跡編集アプリケーション。Autowareの軌跡編集機能をベースに独立したツールとして開発されました。

[English README](README_EN.md) | [日本語 README](README.md)

## 🚗 概要

このスタンドアロンアプリケーションは、Qt GraphicsViewを使用してCSV軌跡データを直感的に視覚編集できます。デュアル軌跡比較、速度の色分け表示、インタラクティブな編集操作をサポートしています。

## ✨ 主要機能

### 🎯 軌跡編集
- **デュアル軌跡対応**: 2つのCSV軌跡を同時読み込み・比較
- **色分け速度表示**: 軌跡1は緑系、軌跡2は青系で表示
- **単位変換**: 内部はm/s保存、UIはkm/h表示
- **複数CSV形式**: 4列形式(x,y,z,velocity)と8列形式(x,y,z,qx,qy,qz,qw,speed)に対応
- **点編集**: クリック&ドラッグで軌跡座標の修正
- **速度編集**: 個別点および範囲での速度編集
- **編集履歴**: コマンドパターンによるUndo/Redo機能

### 🗺️ トラック可視化
- **トラック境界**: 左右境界をグレー点で表示
- **座標系対応**: 東北・東南・南西・北西の4種類
- **自動フィット**: 座標系変更時の自動ビュー調整
- **ズーム維持**: 軌跡編集中のズームレベル保持

### 🖱️ インタラクティブ操作
- **マウス操作**:
  - **左クリック**: 軌跡点の選択・編集
  - **中ボタン+ドラッグ**: ビューのパン移動
  - **マウスホイール**: ズームイン・アウト
  - **点ドラッグ**: 5ピクセル感度での軌跡点移動
- **キーボードショートカット**: 標準的なズーム・フィット操作
- **レスポンシブUI**: 高密度軌跡データに最適化

### 🎨 表示カスタマイズ
- **点サイズ**: 0.5から大サイズまで調整可能
- **線幅**: 軌跡線の太さ設定
- **枠線なし**: すっきりとした点表示
- **速度色マッピング**: 最小/中間/最大速度範囲のカスタマイズ

## 🏗️ アーキテクチャ

```
src/
├── core/                    # データ管理
│   ├── trajectory_data.hpp/.cpp    # 軌跡データ構造
│   ├── track_boundaries.hpp/.cpp   # トラック境界データ
│   └── edit_history.hpp/.cpp       # コマンドパターン編集
├── gui/                     # ユーザーインターフェース
│   └── graphics_trajectory_view.hpp/.cpp  # Qt GraphicsView表示
├── utils/                   # ユーティリティ
│   ├── csv_parser.hpp/.cpp         # CSVファイル処理
│   └── osm_parser.hpp/.cpp         # OSM/Lanelet2解析
└── main.cpp                 # メインアプリケーション
```

## 🔧 技術仕様

### 開発環境
- **言語**: C++17
- **GUIフレームワーク**: Qt5 (Core, Widgets)
- **ビルドシステム**: CMake 3.16+
- **プラットフォーム**: Linux (Ubuntu で動作確認)

### 依存関係
- Qt5 Core & Widgets
- CMake 3.16+
- C++ 標準ライブラリ

## 📁 データ形式

### 軌跡データ (CSV)
```csv
# 4列形式
x,y,z,velocity_ms
89626.42,43187.84,6.5,2.777

# 8列形式 (AWSIM)
x,y,z,qx,qy,qz,qw,speed
89631.12,43131.45,0,0,0,0.893,0.449,9.72222
```

### トラック境界 (CSV)
```csv
left_x,left_y,left_z,right_x,right_y,right_z
89684.1,43139.7,6.5,89682.9,43141.4,6.5
```

## 🔨 ビルド手順

```bash
# 依存関係インストール (Ubuntu/Debian)
sudo apt-get update
sudo apt-get install qt5-default cmake build-essential

# クローンとビルド
git clone https://github.com/takatom328/standalone-trajectory-editor.git
cd standalone-trajectory-editor
mkdir build && cd build
cmake ..
cd ..
make -j$(nproc)

# 実行
./trajectory_editor
```

## 🎮 使用方法

### 基本操作

1. **軌跡の読み込み**:
   - 緑軌跡: 「Load CSV 1」ボタン使用
   - 青軌跡: 「Load CSV 2」ボタン使用
   - ファイル名は色分けされた表示

2. **ナビゲーション**:
   - **パン**: 中マウスボタン + ドラッグ
   - **ズーム**: マウスホイール
   - **ビューフィット**: 座標系ドロップダウンで自動フィット

3. **軌跡編集**:
   - **点選択**: 軌跡点を左クリック (5px感度)
   - **点移動**: 選択した点をドラッグで新位置へ移動
   - **速度編集**: 速度編集パネルで個別または範囲編集

4. **表示制御**:
   - **点サイズ**: 高密度軌跡用に0.5から調整
   - **線幅**: 軌跡線の太さを変更
   - **座標系**: 東北・東南などに切り替え

5. **結果保存**:
   - 「Save CSV 1」/「Save CSV 2」: 軌跡を個別にm/s単位で保存

### 高度な機能

- **ズーム維持**: 点編集中もズームレベルが維持される
- **デュアル比較**: 2つの軌跡を並べて解析
- **高密度対応**: `raceline_awsim_shortest_m_11.csv`などの大容量ファイルに最適化
- **ファイル名表示**: 読み込み中のファイル名をコントロールパネルに表示

## 📊 パフォーマンス

### テスト済みデータセット
- **高密度軌跡**: 1000+点 (raceline_awsim_shortest_m_11.csv)
- **トラック境界**: 268+境界点
- **リアルタイム応答**: 高密度データでもスムーズな操作

### 座標範囲例
- **X軸**: 89612.7 ~ 89686.7
- **Y軸**: 43116.6 ~ 43193.1  
- **Z軸**: 通常6.5m (地面レベル)

## 🚀 今後の機能拡張

### 予定機能
- [ ] 3D可視化サポート
- [ ] スプライン補間による滑らかな軌跡
- [ ] アニメーション・再生機能
- [ ] KML/GPX形式エクスポート
- [ ] ROSbag統合

### UI改善
- [ ] ダークテーマサポート
- [ ] 設定可能なカラースキーム
- [ ] 多言語サポート
- [ ] プラグインアーキテクチャ

## 📝 ライセンス

このプロジェクトはMITライセンスの下で公開されています - 詳細は[LICENSE](LICENSE)ファイルをご覧ください。

## 🤝 コントリビューション

1. リポジトリをフォーク
2. フィーチャーブランチを作成
3. 変更を実装
4. テスト追加（該当する場合）
5. プルリクエストを提出

詳細な貢献ガイドラインは[CONTRIBUTING.md](CONTRIBUTING.md)をご覧ください。

## 🐛 バグレポート

以下の情報を含めてGitHub Issuesでバグを報告してください：
- オペレーティングシステムとバージョン
- Qtバージョン
- 再現手順
- サンプルデータファイル（該当する場合）

## 📈 開発状況

**現在のバージョン**: プロトタイプ v1.0
- ✅ コア軌跡編集機能
- ✅ デュアル軌跡サポート  
- ✅ インタラクティブパン・ズーム
- ✅ 速度可視化
- ✅ 単位変換 (m/s ↔ km/h)
- ✅ コマンドパターン編集
- ✅ 複数CSV形式サポート

## 🌟 活用例

### 自動車分野
- **経路計画**: 自動運転車の軌跡最適化
- **テストコース解析**: サーキット・テストコースでの車両軌跡分析
- **速度プロファイル調整**: コーナリング・直線での最適速度設定

### ロボティクス分野
- **ナビゲーション**: 移動ロボットの経路計画
- **マッピング**: SLAM軌跡データの可視化・編集
- **動作最適化**: ロボットアームの軌道生成

### 研究・教育
- **アルゴリズム検証**: 経路計画アルゴリズムの結果可視化
- **データ解析**: 実験データの後処理・分析
- **デモンストレーション**: 軌跡データの分かりやすい表示

## 📚 関連リソース

### 技術ドキュメント
- [Qt5ドキュメント](https://doc.qt.io/qt-5/)
- [Qt Graphics Viewフレームワーク](https://doc.qt.io/qt-5/graphicsview.html)
- [C++コアガイドライン](https://isocpp.github.io/CppCoreGuidelines/)

### 応用分野
- [Autoware](https://autoware.org/) - オープンソース自動運転プラットフォーム
- [ROS](https://www.ros.org/) - ロボットオペレーティングシステム
- [AWSIM](https://tier4.github.io/AWSIM/) - Autoware用シミュレータ

---

*Claude Codeで生成* 🤖